<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Debug - Флибуста</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">Debug Page</h1>
        
        <div class="bg-gray-800 p-6 rounded-lg mb-6">
            <h2 class="text-xl font-semibold mb-4">Authentication Test</h2>
            <button id="testAuth" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                Test Authentication
            </button>
            <div id="authResult" class="mt-4 p-4 bg-gray-700 rounded-lg hidden">
                <pre id="authData" class="text-sm"></pre>
            </div>
        </div>
        
        <div class="bg-gray-800 p-6 rounded-lg mb-6">
            <h2 class="text-xl font-semibold mb-4">Admin Updates Test</h2>
            <button id="testAdminUpdates" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                Test Admin Updates API
            </button>
            <div id="adminResult" class="mt-4 p-4 bg-gray-700 rounded-lg hidden">
                <pre id="adminData" class="text-sm"></pre>
            </div>
        </div>
        
        <div class="bg-gray-800 p-6 rounded-lg">
            <h2 class="text-xl font-semibold mb-4">Console Logs</h2>
            <div id="consoleLogs" class="bg-gray-900 p-4 rounded-lg h-64 overflow-y-auto font-mono text-sm">
                <div class="text-gray-400">Console logs will appear here...</div>
            </div>
        </div>
    </div>

    <script>
        // Override console.log to capture logs
        const originalLog = console.log;
        const originalError = console.error;
        const logsContainer = document.getElementById('consoleLogs');
        
        function addLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'text-red-400' : 'text-blue-400';
            const logEntry = document.createElement('div');
            logEntry.className = `mb-1 ${colorClass}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };
        
        // Test authentication
        document.getElementById('testAuth').addEventListener('click', async () => {
            console.log('Testing authentication...');
            try {
                const response = await fetch('/api/auth/me', {
                    credentials: 'include'
                });
                console.log('Auth response status:', response.status);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('Auth result:', result);
                    document.getElementById('authData').textContent = JSON.stringify(result, null, 2);
                    document.getElementById('authResult').classList.remove('hidden');
                } else {
                    console.error('Auth failed:', response.status);
                    document.getElementById('authData').textContent = `Failed: ${response.status}`;
                    document.getElementById('authResult').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Auth error:', error);
                document.getElementById('authData').textContent = `Error: ${error.message}`;
                document.getElementById('authResult').classList.remove('hidden');
            }
        });
        
        // Test admin updates
        document.getElementById('testAdminUpdates').addEventListener('click', async () => {
            console.log('Testing admin updates...');
            try {
                const response = await fetch('/api/admin/updates/status', {
                    credentials: 'include'
                });
                console.log('Admin updates response status:', response.status);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('Admin updates result:', result);
                    document.getElementById('adminData').textContent = JSON.stringify(result, null, 2);
                    document.getElementById('adminResult').classList.remove('hidden');
                } else {
                    console.error('Admin updates failed:', response.status);
                    document.getElementById('adminData').textContent = `Failed: ${response.status}`;
                    document.getElementById('adminResult').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Admin updates error:', error);
                document.getElementById('adminData').textContent = `Error: ${error.message}`;
                document.getElementById('adminResult').classList.remove('hidden');
            }
        });
        
        console.log('Debug page loaded');
    </script>
</body>
</html>
